<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	작성일 : 2024.10.21
	작성자 : 김준식
	내용 : 상품 관련 내용 입니다.
 -->
<mapper namespace="com.Joonggodeal.joonggodeal.Admin.Product.DAO.AdminProductDao">
    <!--
	작성일 : 2024.10.21
	작성자 : 김준식
	내용 : 상품 등록
    -->
    <insert id="goodsRegister" parameterType="com.Joonggodeal.joonggodeal.Admin.Product.DTO.productDto" >
        INSERT INTO joonggodeal.goods (goods_name, goods_company, start_price, description, category_idx, goods_title, file_name, admin_idx)
        VALUES (#{name}, #{manufacturer}, #{price}, #{description},
                (
                    select idx
                    from joonggodeal.category
                    where category_name = #{category}
                    ), #{title}, #{filename}, (select idx
                                               from joonggodeal.admin_info
                                               where admin_id = #{id}));
    </insert>

    <!--
	작성일 : 2024.10.22
	작성자 : 김준식
	내용 : 상품 수정
    -->
    <update id="goodsUpdate" parameterType="com.Joonggodeal.joonggodeal.Admin.Product.DTO.productDto">
        UPDATE joonggodeal.goods
        SET goods_name = #{name}, goods_company = #{manufacturer}, description = #{description},
            start_price = #{price},
            category_idx = (
                select idx
                from joonggodeal.category
                where category_name = #{category}
            ),
            goods_title = #{title}, registe_date = now(),
            file_name = #{filename}
        WHERE idx = #{idx};
    </update>
    <!--
	작성일 : 2024.10.22
	작성자 : 김준식
	내용 : 상품 삭제
    -->
    <delete id="goodsDelete" parameterType="HashMap">
        DELETE FROM joonggodeal.goods
        WHERE idx = #{idx};
    </delete>
    <!--
	작성일 : 2024.10.22
	작성자 : 김준식
	내용 : 해당 카테고리의 상품중 한개 상품만 불러오기
    -->
    <select id="getOneGoods" parameterType="HashMap" resultType="HashMap">
        SELECT g.idx as idx, g.goods_title as title, g.goods_name as name, g.goods_company as manufacturer, g.start_price as price, g.description as description, ca.category_name as category, g.file_name as image
        FROM joonggodeal.goods as g
             JOIN joonggodeal.category as ca ON g.category_idx = ca.idx
        WHERE g.idx = #{idx};
    </select>

    <!--
	작성일 : 2024.10.22
	작성자 : 김준식
	내용 : 해당 카테고리의 상품을 모두 불러오기
    -->
    <select id="getAllGoods" parameterType="HashMap" resultType="HashMap">
            select g.idx as idx,g.goods_name as name, g.goods_title as title, g.start_price as start_price, g.bid_price as bid_price, g.goods_company as company,
                ca.category_name as category_name, m.member_id as id
            from joonggodeal.goods as g
                join joonggodeal.member as m on g.buy_member = m.idx
                join joonggodeal.category as ca on g.category_idx = ca.idx
                join joonggodeal.admin_info as a on g.admin_idx = a.idx
            where a.admin_id = #{id}
            order by g.idx DESC;
    </select>

    <select id="getCategory" resultType="String">
        SELECT category_name
        FROM joonggodeal.category
    </select>

</mapper>